(this.webpackJsonpview=this.webpackJsonpview||[]).push([[0],{172:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),c=a(49),o=a.n(c),r=(a(97),a(30)),i=a(14),l=a(38),d=a(4),u=a.n(d),j=a(9),h=a(3),m=a(10),g=a.n(m),b=a(19),p=a.n(b),f=(a(116),a(44)),O=a.n(f),v=a(92),x=a(43),w="/api/",C=[{secure:!0,query:{access_token:localStorage.access_token}}];window.location.href.includes("localhost")&&(w="https://localhost:3001/api/",C.unshift("https://localhost:3001/"));var y={params:{access_token:localStorage.access_token}},S=x.version,_=a(51),N=a.n(_),I=a(7),k=a.n(I),A=a(91),M=a(85),E=a(18),B=a.n(E),D=a.p+"static/media/call.09b0b113.svg",q=a.p+"static/media/search.ec480aa4.svg",T=a(0),R=function(e){var t=e.handleNewContact,a=e.handleQuery,s=e.handleModal,c=Object(n.useState)(""),o=Object(h.a)(c,2),r=o[0],i=o[1],l=Object(n.useState)(!1),d=Object(h.a)(l,2),u=d[0],j=d[1];return Object(T.jsxs)("div",{className:B.a.searchContainer,children:[Object(T.jsx)("input",{placeholder:"Pesquisar...",type:"text",value:r,onChange:function(e){var t=e.target.value;i(t),a(t,u)}}),Object(T.jsx)("button",{onClick:function(){j(!u),a(r,!u)},children:Object(T.jsx)("div",{className:k()(B.a.pin,B.a[u])})}),Object(T.jsx)("button",{onClick:function(){return s("advancedSearch")},children:Object(T.jsx)("img",{src:q,alt:"Busca avan\xe7ada"})}),Object(T.jsx)("button",{onClick:t,children:Object(T.jsx)("img",{src:D,alt:"Nova conversa"})})]})},L=a(11),F=a.n(L),P=a.p+"static/media/share.d7b0a515.svg";function V(e){var t,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=/\*(.+?)\*/g,s=/_(.+?)_/g,c=/\n/g,o="<br />";return"string"===typeof e?t=e:Array.isArray(e)&&(t=e.join(" ")),a||(o="&nbsp;"),"string"!==typeof t?t:t.replace(s,"<i>$1</i>").replace(c,o).replace(n,"<b>$1</b>")}var G,J,U=function(e){var t=e.slice(2,e.indexOf("@")),a=t.slice(0,2),n=t.slice(-4),s=t.slice(2,-4);return 4===s.length&&(s="9"+s),"(".concat(a,") ").concat(s,"-").concat(n)},W=a(52),Q=a(53),H=function(e){var t=e.text,a=e.enter,n=Object(W.renderToString)(Object(T.jsx)(Q.Emojione,{text:t}));return Object(T.jsx)("span",{dangerouslySetInnerHTML:{__html:V(n,a)}})},z=function(e){var t=e.text,a=e.enter,n=Object(W.renderToString)(Object(T.jsx)(Q.Emojione,{text:t}));return Object(T.jsx)("p",{dangerouslySetInnerHTML:{__html:V(n,a)}})},K={sameDay:"HH:mm",nextDay:"[Tomorrow]",lastDay:"[Ontem]",lastWeek:"dddd",sameElse:"DD/MM/YYYY"},Y=function(e){var t,a=e.data,s=e.handleClick,c=e.style,o=Object(n.useState)(""),r=Object(h.a)(o,2),i=r[0],l=r[1],d=Object(n.useState)(),u=Object(h.a)(d,2),j=u[0],m=u[1],g="initial";window.agents&&(t=window.agents,p.a.forEach(t,(function(e,t){t===a.agentId&&(g=e.color)})));return Object(n.useEffect)((function(){!function(){var e=a.messages[0];e?"chat"===e.type?l(e.body):"ptt"===e.type?l("\xc1udio"):"sale"===e.type?l("Venda"):"image"===e.type?l("\ud83d\udcf7 Foto"):"sticker"===e.type?l("\ud83d\udcf7 Adesivo"):l(e.type):l("~Sem mensagem"),e&&m(e.mine)}()})),Object(T.jsxs)("div",{className:B.a.chat,style:c,onClick:s,children:[Object(T.jsx)("img",{src:a.profilePic,alt:"Chat"}),Object(T.jsxs)("div",{children:[Object(T.jsxs)("div",{className:B.a.info,children:[Object(T.jsx)("b",{children:a.displayName}),Object(T.jsx)("p",{children:F()(a.lastMessageAt).calendar(K)})]}),Object(T.jsxs)("div",{className:B.a.message,children:[j&&Object(T.jsx)("img",{src:P,alt:"Enviado"}),i&&Object(T.jsx)(z,{text:i,enter:!1}),a.agentId&&Object(T.jsx)("span",{className:B.a.letter,style:{backgroundColor:g},children:t[a.agentId].firstLetter}),a.unread>0&&Object(T.jsx)("span",{className:B.a.unread,children:a.unread})]})]})]})},Z=function(){return Object(T.jsx)("div",{className:k()(B.a.chat,B.a.lowBattery),children:"A bateria est\xe1 acabando. Carregue o celular principal."})},X=s.a.memo(Z),$=a.p+"static/media/rocket.dcebd764.svg",ee=a.p+"static/media/sync.1a2eb9a5.svg",te=a.p+"static/media/changeUser.5dc72a9f.svg",ae=a.p+"static/media/gear.3af61fb8.svg",ne=function(e){var t,a=e.logout,n=e.handleSettings,s=e.isLaunch,c=e.handleManualSync,o=(t=localStorage.salesAgentProfile?JSON.parse(localStorage.salesAgentProfile):JSON.parse(localStorage.agents)[localStorage.userId])&&t.fullName||"",r=localStorage.useSavedData;return Object(T.jsxs)("div",{className:k()(B.a.header),children:[Object(T.jsx)("img",{className:B.a.bg,src:"data:image/png;base64,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",alt:"Zoppy"}),Object(T.jsx)("p",{children:o}),Object(T.jsx)("button",{onClick:n,children:Object(T.jsx)("img",{src:ae,alt:"Alterar configura\xe7\xf5es"})}),Object(T.jsx)("button",{onClick:function(){return a()},children:Object(T.jsx)("img",{src:te,alt:"mudar usu\xe1rio"})}),s?Object(T.jsx)("button",{onClick:function(){return window.location.href="/launch"},children:Object(T.jsx)("img",{src:$,alt:"lan\xe7amento"})}):null,r?Object(T.jsx)("button",{onClick:c,children:Object(T.jsx)("img",{src:ee,alt:"Sincronizar"})}):null]})},se=s.a.memo(ne),ce=a(54),oe=a.n(ce),re=function(){return Object(T.jsx)("div",{className:oe.a.container,children:Object(T.jsxs)("div",{className:oe.a.loader,children:[Object(T.jsx)("div",{}),Object(T.jsx)("div",{}),Object(T.jsx)("div",{}),Object(T.jsx)("div",{})]})})},ie=function(e){var t=e.data,a=e.index,n=e.style;return Object(T.jsx)(Y,{style:n,data:t.dataToShow[a],handleClick:function(){return t.handleSelectChat(t.dataToShow[a].chatId)}})},le=function(e){var t=e.data,a=e.handleQuery,s=e.handleSelectChat,c=e.handleModal,o=e.handleNewContactModal,r=e.handleSettingsModal,i=e.handleManualSync,l=e.showing,d=e.logout,u=e.isLaunch,j=e.lowBattery,m=Object(n.useState)(t),g=Object(h.a)(m,2),b=g[0],p=g[1];return Object(n.useEffect)((function(){p(t.filter((function(e){return e.filtered})))}),[t]),Object(T.jsxs)("div",{className:k()(B.a.container,"mobile-fullwidth",l),children:[localStorage.agents&&localStorage.userId&&Object(T.jsx)(se,{logout:d,handleSettings:r,handleManualSync:i,isLaunch:u}),Object(T.jsx)(R,{handleNewContact:o,handleQuery:a,handleModal:c}),j&&Object(T.jsx)(X,{}),Object(T.jsx)("div",{className:B.a.chatsList,children:t.length?Object(T.jsx)(M.a,{children:function(e){var t=e.height,a=e.width;return Object(T.jsx)(A.a,{height:t,itemData:{dataToShow:b,handleSelectChat:s},itemCount:b.length,itemSize:81,width:a,children:ie})}}):Object(T.jsx)(re,{})})]})},de=a.p+"static/media/notification.4b0b7450.ogg",ue=a.p+"static/media/red.bdd9e85a.svg",je=a.p+"static/media/green.fff38e5b.svg",he=a.p+"static/media/yellow.2d747e33.svg",me=a.p+"static/media/blue.39c79876.svg",ge=a.p+"static/media/orange.982b711d.svg",be=a.p+"static/media/purple.b7a5ec5e.svg",pe=a(23),fe=a.n(pe),Oe=a.p+"static/media/back.97d6c85a.svg",ve=function(e){var t=e.data,a=e.handleBack,n=e.handleToggleDetails;return Object(T.jsxs)("header",{className:fe.a.header,children:[Object(T.jsx)("button",{onClickCapture:a,className:k()(fe.a.arrow,"mobile-only"),children:Object(T.jsx)("img",{src:Oe,alt:"back"})}),Object(T.jsxs)("div",{className:fe.a.headerContent,onClick:n,children:[Object(T.jsx)("img",{className:fe.a.profilePic,src:t.profilePic,alt:"Foto"}),Object(T.jsx)("div",{className:fe.a.name,children:Object(T.jsx)("div",{className:fe.a.nameContainer,children:Object(T.jsx)("span",{title:t.displayName,children:t.displayName})})})]})]})},xe=a(20),we=a.n(xe),Ce=(a(160),a(90)),ye=a.p+"static/media/send.4eef2c1d.svg",Se=a.p+"static/media/emoji.86604dab.svg",_e=a.p+"static/media/camera.e0cb18cc.svg",Ne=a.p+"static/media/bag.c4a6d9fb.svg",Ie=a(86),ke=a.n(Ie),Ae=a.p+"static/media/cancel.91a3f1e4.svg",Me=a.p+"static/media/sucess.d1ab63d2.svg",Ee=a.p+"static/media/mic.e0b5930a.svg",Be=new ke.a({bitRate:128}),De=function(e){if(!e&&0!==e)return"";var t=Math.floor(e/60),a=Math.round(e%60),n=a;return a<10&&(n="0"+a),t+":"+n},qe=window.innerWidth<=600,Te=function(e){var t=e.setIsRecording,a=e.sendAudio,s=Object(n.useState)(0),c=Object(h.a)(s,2),o=c[0],r=c[1],i=Object(n.useState)(!1),l=Object(h.a)(i,2),d=(l[0],l[1]),u=Object(n.useState)(""),j=Object(h.a)(u,2),m=j[0],g=j[1],b=Object(n.useState)(0),p=Object(h.a)(b,2),f=p[0],O=p[1],v=Object(n.useState)(),x=Object(h.a)(v,2),w=x[0],C=x[1],y=function(e){console.log(qe),e.preventDefault(),o?N():S()},S=function(){console.log("STARTED"),Be.start(),r(!0),g(""),_()},_=function(){var e=0,t=setInterval((function(){O(++e)}),1e3);C(t)},N=function(){console.clear(),t(!1),r(!1),Be.stop().getMp3().then((function(e){var t=Object(h.a)(e,2),a=(t[0],t[1]);g(a)})),O(0),clearInterval(w)};return Object(n.useEffect)((function(){navigator.getUserMedia?navigator.getUserMedia({audio:!0},(function(){console.log("Permission Granted"),d(!0)}),(function(){console.log("Permission Denied"),d(!1)})):d(!1)}),[]),Object(n.useEffect)((function(){!o&&m&&m.size>1&&(console.log(m),a(m)),t(Boolean(o))}),[m,o]),Object(T.jsx)("div",{children:o?Object(T.jsxs)("div",{className:we.a.voiceMessageRecorder,children:[Object(T.jsx)("div",{children:De(f)}),Object(T.jsx)("button",{onClick:y,children:Object(T.jsx)("img",{className:we.a.recording,src:Me,alt:"Enviar \xe1udio"})}),Object(T.jsx)("button",{onClick:function(){r(!1),Be.stop().getMp3().then((function(){g("")})),O(0),clearInterval(w)},children:Object(T.jsx)("img",{className:we.a.recording,src:Ae,alt:"Cancelar \xe1udio"})})]}):Object(T.jsx)("button",{className:we.a.record,id:"recorder",onClick:y,children:Object(T.jsx)("img",{src:Ee,alt:"Gravar \xe1udio"})})})},Re=window.innerWidth<=600,Le=function(e){var t=e.message,a=e.handleChangeMessage,s=e.send,c=e.replyId,o=(e.handleReply,e.handleModal),r=e.sendAudio,i=Object(n.useState)(1),l=Object(h.a)(i,2),d=l[0],u=l[1],j=Object(n.useState)(),m=Object(h.a)(j,2),g=m[0],b=m[1],p=Object(n.useState)(!1),f=Object(h.a)(p,2),O=f[0],v=(f[1],Object(n.useState)(!1)),x=Object(h.a)(v,2),w=x[0],C=x[1],y=Object(n.useState)(!1),S=Object(h.a)(y,2),_=S[0],N=S[1],I=Object(n.useRef)();Object(n.useEffect)((function(){localStorage.settings&&JSON.parse(localStorage.settings).salesOptions?C(!0):C(!1)}),[localStorage.settings]);var A,M;A=I,M=function(){b(!1)},Object(n.useEffect)((function(){function e(e){A.current&&!A.current.contains(e.target)&&M(e)}return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),function(){document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[A]);var E=function(){console.log(t,c),s(t,c),a(""),u(1)};return Object(T.jsxs)(T.Fragment,{children:[g&&Object(T.jsx)("div",{className:we.a.emojiContainer,ref:I,children:Object(T.jsx)(Ce.a,{showPreview:!1,showSkinTones:!1,title:"Emoji",set:"apple",onSelect:function(e){a(t+e.native)}})}),Object(T.jsxs)("div",{className:k()(we.a.input,we.a[O]),children:[Object(T.jsx)("button",{className:we.a.hide,onClick:function(){return o("picUpload")},children:Object(T.jsx)("img",{className:we.a.camera,src:_e,alt:"upload"})}),w&&Object(T.jsx)("button",{className:we.a.hide,onClick:function(){return o("sale")},children:Object(T.jsx)("img",{src:Ne,alt:"Nova venda"})}),Object(T.jsx)("button",{onClick:function(){b(!g)},children:Object(T.jsx)("img",{src:Se,alt:"Emoji"})}),Object(T.jsx)("textarea",{type:"text",rows:d,value:t,onKeyDown:function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),t&&E())},onChange:function(e){e.persist();var t=3;Re&&(t=10);var n=e.target.rows;e.target.rows=1;var s=~~(e.target.scrollHeight/24);s===n&&(e.target.rows=s),s>=t&&(e.target.rows=t,e.target.scrollTop=e.target.scrollHeight),a(e.target.value),u(s<t?s:t)},placeholder:"Digite uma mensagem",disabled:_}),t.length?Object(T.jsx)("button",{onClick:function(){return E()},children:Object(T.jsx)("img",{src:ye,alt:"Enviar"})}):Object(T.jsx)(Te,{setIsRecording:N,sendAudio:r})]})]})},Fe=a.p+"static/media/delete.d9483b20.svg",Pe=a.p+"static/media/copy.41c3e896.svg",Ve=a.p+"static/media/reply.22800991.svg",Ge=a(5),Je=a.n(Ge),Ue=a.p+"static/media/clock.5a342c8b.svg",We=function(e){var t=e.data;return t&&t.length>200&&!t.includes(" ")?Object(T.jsx)("img",{alt:"imagem respondida",src:"data:image/jpg;base64,".concat(t)}):Object(T.jsx)("span",{children:t})},Qe=function(e){var t=e.data,a=t.body,n=t.sender,s=t.mine;return Object(T.jsxs)("div",{className:k()(Je.a.quote,Je.a[s]),children:[Object(T.jsx)("span",{className:Je.a.from,children:n}),Object(T.jsx)("br",{}),Object(T.jsx)(We,{data:a})]})},He=function(e){var t=e.message,a=e.isGroup,n=window.agents,s="WhatsApp";return t.agentId&&(s=n[t.agentId].fullName),Object(T.jsxs)("div",{children:[Object(T.jsxs)("div",{className:Je.a.message,children:[a&&!t.mine&&Object(T.jsx)("p",{children:t.sender}),t.mine&&t.agentId&&Object(T.jsx)("p",{children:s}),Object(T.jsxs)("div",{className:Je.a.msg,children:[t.quote?Object(T.jsx)(Qe,{data:t.quote}):null,Object(T.jsx)(H,{text:t.body}),Object(T.jsx)("span",{className:Je.a.buffer})]})]}),Object(T.jsxs)("div",{className:Je.a.time,children:[Object(T.jsx)("p",{children:F()(t.timestamp).format("HH:mm")}),t.sending&&Object(T.jsx)("img",{src:Ue,alt:"Sending"})]})]})},ze=function(e){var t=e.message,a=e.isGroup,n=e.showMedia;return Object(T.jsxs)("div",{children:[Object(T.jsxs)("div",{className:Je.a.message,children:[a&&!t.mine&&Object(T.jsx)("p",{children:t.sender}),Object(T.jsx)("div",{className:Je.a.image,onClick:function(){return n("image",t.messageId)},style:{backgroundImage:"url(data:image/jpg;base64,".concat(t.body,")")},children:Object(T.jsx)("div",{className:Je.a.highResImg,style:{backgroundImage:"url(".concat(w,"chats/download/").concat(t.messageId,"?access_token=").concat(localStorage.access_token,")")}})}),t.caption&&Object(T.jsxs)("div",{className:Je.a.msg,children:[Object(T.jsx)(H,{text:t.caption}),Object(T.jsx)("span",{className:Je.a.buffer})]})]}),Object(T.jsx)("div",{className:Je.a.time,children:Object(T.jsx)("p",{children:F()(t.timestamp).format("HH:mm")})})]})},Ke=function(e){var t=e.message;return Object(T.jsx)("div",{className:Je.a.sale,children:Object(T.jsx)("p",{children:t.body})})},Ye=function(e){var t=e.message,a=e.isGroup,s=Object(n.useState)(null),c=Object(h.a)(s,2),o=c[0],r=c[1],i=Object(n.useState)(!1),l=Object(h.a)(i,2),d=l[0],m=l[1],g=Object(n.useState)(""),b=Object(h.a)(g,2),p=b[0],f=b[1],O=Object(n.useRef)(!0),v=window.agents,x=function(){var e=Object(j.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m(!d);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C="WhatsApp";t.agentId&&(C=v[t.agentId].fullName);var y=function(e){O.current&&f(function(e){if(!e)return"";var t=Math.floor(e/60),a=Math.round(e%60),n=a;return a<10&&(n="0"+a),t+":"+n}(t.duration))};return Object(n.useEffect)((function(){return function(){O.current=!1}}),[]),Object(n.useEffect)((function(){try{var e=new Audio("".concat(w,"chats/download/").concat(t.messageId,"?access_token=").concat(localStorage.access_token));r(e)}catch(a){console.log(a)}}),[t.messageId]),Object(n.useEffect)((function(){if(o)try{for(var e=document.getElementsByTagName("audio"),t=0;t<e.length;t++)e[t].pause();return d?o.play():o.pause(),o.addEventListener("ended",(function(){return m(!1)})),o.addEventListener("loadeddata",(function(){return y()})),function(){o.removeEventListener("ended",(function(){return m(!1)})),o.removeEventListener("loadeddata",(function(){return y()}))}}catch(a){alert("erro ao reproduzir!"),console.log(a)}}),[d,o]),Object(T.jsx)("div",{children:Object(T.jsxs)("div",{children:[Object(T.jsxs)("div",{className:Je.a.message,children:[a&&!t.mine&&Object(T.jsx)("p",{children:t.sender}),t.agentId&&Object(T.jsx)("p",{children:C}),Object(T.jsxs)("div",{className:Je.a.msg,children:[Object(T.jsx)("div",{onClick:x,className:Je.a.audio,children:Object(T.jsx)("div",{className:k()(d?Je.a.paused:null,Je.a.audioController)})}),Object(T.jsx)("span",{children:p})]})]}),Object(T.jsx)("div",{className:Je.a.time,children:Object(T.jsx)("p",{children:F()(t.timestamp).format("HH:mm")})})]})})},Ze=function(e){var t=e.message,a=e.isGroup;return Object(T.jsxs)("div",{className:Je.a.noBg,children:[Object(T.jsxs)("div",{className:Je.a.message,children:[a&&!t.mine&&Object(T.jsx)("p",{children:t.sender}),Object(T.jsx)("div",{className:Je.a.sticker,children:Object(T.jsx)("img",{src:"".concat(w,"chats/download/").concat(t.messageId,"?access_token=").concat(localStorage.access_token),alt:"Adesivo"})})]}),Object(T.jsx)("div",{className:Je.a.time,children:Object(T.jsx)("p",{children:F()(t.timestamp).format("HH:mm")})})]})},Xe=function(e){var t=e.message,a=e.isGroup,n=e.showMedia;return Object(T.jsx)("div",{children:Object(T.jsxs)("div",{children:[Object(T.jsxs)("div",{className:Je.a.message,children:[a&&!t.mine&&Object(T.jsx)("p",{children:t.sender}),Object(T.jsx)("div",{className:Je.a.image,onClick:function(){return n("video",t.messageId)},style:{backgroundImage:"url(data:image/jpg;base64,".concat(t.body,")")}}),t.caption&&Object(T.jsxs)("div",{className:Je.a.msg,children:[Object(T.jsx)(H,{text:t.caption}),Object(T.jsx)("span",{className:Je.a.buffer})]})]}),Object(T.jsx)("div",{className:Je.a.time,children:Object(T.jsx)("p",{children:F()(t.timestamp).format("HH:mm")})})]})})},$e=function(e){var t=e.selected,a=e.mine,n=e.text,s=e.handleDelete,c=e.handleReply;return Object(T.jsxs)("div",{className:k()(Je.a.options,Je.a[t]),children:[Object(T.jsx)("div",{children:Object(T.jsx)("img",{src:Ve,alt:"responder",className:Je.a.option,onClick:c})}),n?Object(T.jsx)("div",{children:Object(T.jsx)("img",{src:Pe,alt:"copiar",className:Je.a.option,onClick:function(){navigator.clipboard.writeText(n),console.log("COPIED")}})}):null,a?Object(T.jsx)("div",{children:Object(T.jsx)("img",{src:Fe,alt:"excluir mensagem",className:Je.a.option,onClick:s})}):null]})},et=function(e){var t,a,s=e.message,c=e.isGroup,o=e.showMedia,r=e.handleDelete,i=e.handleReply,l=s.mine?Je.a.right:Je.a.left,d=s.mine?"message-out":"message-in",u=Object(n.useState)(!1),j=Object(h.a)(u,2),m=j[0],g=j[1],b=1,p="transparent";s.sending&&(b=.8),!0===m&&(p="#add8e66b"),"chat"===s.type?a=He:"image"===s.type?a=ze:"video"===s.type?a=Xe:"sticker"===s.type?a=Ze:"ptt"!==s.type&&"audio"!==s.type||(a=Ye);return"sale"===s.type?Object(T.jsx)("div",{className:Je.a.container,children:Object(T.jsx)(Ke,{message:s})}):a?Object(T.jsxs)("div",{className:k()(Je.a.container,l,d),style:{opacity:b,backgroundColor:p},"data-id":s.messageId,onClick:function(e){m||t?t&&(console.log(2),g(!0),setTimeout((function(){g(!1),t=0}),5e3)):(console.log(1,t,e.timeStamp-t),t=1,setTimeout((function(){t=0}),200))},children:[Object(T.jsx)(a,{showMedia:o,message:s,isGroup:c}),Object(T.jsx)($e,{handleDelete:function(){console.log(s.messageId),r(s.messageId)},handleReply:function(){console.log(s.messageId),i(s.messageId)},selected:m,mine:s.mine,text:"chat"===s.type?s.body:0})]}):null},tt={sameDay:"[Hoje]",lastDay:"[Ontem]",lastWeek:"dddd",sameElse:"DD/MM/YYYY"},at=function(e){var t=e.day;return Object(T.jsx)("div",{className:k()(Je.a.container,Je.a.center),children:Object(T.jsx)("div",{className:Je.a.day,children:F()(t).calendar(tt)})})},nt=function(e){var t,a=e.messages,s=e.more,c=e.handleModal,o=e.loading,r=e.initialText,l=e.chatId,d=e.handleLoadMore,u=e.send,j=e.handleDelete,m=e.sendAudio,g=e.showMedia,b=Object(n.useState)(""),p=Object(h.a)(b,2),f=p[0],O=p[1],v=Object(n.useState)(!1),x=Object(h.a)(v,2),w=x[0],C=x[1],y=Object(n.useState)(""),S=Object(h.a)(y,2),_=S[0],N=S[1],I=l.includes("-"),k=Object(n.useRef)(),A=new Date((null===(t=a[0])||void 0===t?void 0:t.timestamp)||null);console.log(A,l);var M=function(e){N(e)};return Object(n.useEffect)((function(){r&&!1===f&&O(r)}),[r,l]),Object(n.useEffect)((function(){C(0)}),[l]),Object(n.useEffect)((function(){var e;(w<3||(null===(e=a[0])||void 0===e?void 0:e.mine))&&(C(w+1),k.current.scrollIntoView())}),[a]),Object(T.jsxs)("div",{className:we.a.chat,children:[Object(T.jsx)("div",{className:we.a.scroll,children:Object(T.jsx)("div",{className:we.a.container,children:Object(T.jsxs)("div",{className:we.a.messages,children:[Object(T.jsx)("div",{ref:k,id:"bottom"}),Object(T.jsxs)(T.Fragment,{children:[a.length&&a.map((function(e,t){var s=Object(i.a)({},e),c=A;if("object"!==typeof e)return null;var o=s.timestamp;return s.mine&&!s.agentId&&(s.agentId="wpp"),A=o,"none"===s||s.chatId!==l?null:t===a.length-1?Object(T.jsxs)(n.Fragment,{children:[Object(T.jsx)(et,{handleReply:M,handleDelete:j,showMedia:g,message:s,isGroup:I},s.messageId),Object(T.jsx)(at,{day:c})]},s.messageId):F()(c).isSame(A,"day")?Object(T.jsx)(et,{handleReply:M,showMedia:g,handleDelete:j,message:s,isGroup:I},s.messageId):Object(T.jsxs)(n.Fragment,{children:[Object(T.jsx)(at,{day:c}),Object(T.jsx)(et,{handleReply:M,handleDelete:j,showMedia:g,message:s,isGroup:I})]},s.messageId)})),o&&Object(T.jsx)(re,{}),s&&Object(T.jsx)("div",{onClick:d,className:we.a.loadMore,children:"Carregar mais"})]})]})})}),Object(T.jsx)(Le,{handleModal:c,message:f,handleChangeMessage:O,handleReply:M,replyId:_,send:u,sendAudio:m})]})},st=function(e){var t=e.showing;return Object(T.jsx)("div",{className:k()(fe.a.centerContainer,fe.a.noChat,"mobile-fillWidth",t),children:Object(T.jsx)("h1",{children:"Selecione uma conversa no chat ao lado"})})},ct=a(24),ot=a.n(ct),rt=a.p+"static/media/swap.edd4f2a9.svg",it=a.p+"static/media/income.7a744b5d.svg",lt=a.p+"static/media/outcome.73daf9ec.svg",dt=a.p+"static/media/inAndOut.2db43181.svg",ut=function(e){var t=e.incoming,a=e.outcoming,n=e.noTotal;return Object(T.jsxs)("div",{className:ot.a.counter,children:[Object(T.jsx)("span",{children:t}),Object(T.jsx)("img",{src:it,alt:"Recebidas"}),Object(T.jsx)("span",{children:a}),Object(T.jsx)("img",{src:lt,alt:"Recebidas"}),n?null:Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("span",{children:a+t}),Object(T.jsx)("img",{src:dt,alt:"Total"})]})]})},jt=function(e){var t=e.data,a=function(e){var t=F.a.duration(e).seconds(),a=F.a.duration(e).minutes();return Math.trunc(F.a.duration(e).asHours())+":"+a+":"+t};return Object(T.jsxs)("div",{className:ot.a.statsContainer,children:[Object(T.jsxs)("div",{children:[Object(T.jsx)("h1",{children:"Primeira mensagem: "}),Object(T.jsx)("span",{children:t.salesContacted?"Vendedor":"Lead"})]}),Object(T.jsxs)("div",{children:[Object(T.jsx)("h1",{children:"Tempo de resposta inicial: "}),Object(T.jsx)("span",{children:a(t.initialResponseTime)})]}),Object(T.jsxs)("div",{children:[Object(T.jsx)("h1",{children:"Total:"}),Object(T.jsx)(ut,{incoming:t.receivedMessages,outcoming:t.sentMessages})]}),Object(T.jsxs)("div",{children:[Object(T.jsx)("h1",{children:"Mensagens:"}),Object(T.jsx)(ut,{incoming:t.receivedTexts,outcoming:t.sentTexts})]}),Object(T.jsxs)("div",{children:[Object(T.jsx)("h1",{children:"\xc1udios:"}),Object(T.jsx)(ut,{incoming:t.receivedAudios,outcoming:t.sentAudios})]}),Object(T.jsxs)("div",{children:[Object(T.jsx)("h1",{children:"Fotos:"}),Object(T.jsx)(ut,{incoming:t.receivedImages,outcoming:t.sentImages})]}),Object(T.jsxs)("div",{children:[Object(T.jsx)("h1",{children:"Tempo de resposta m\xe9dio:"}),Object(T.jsx)(ut,{incoming:a(t.avgReceive),outcoming:a(t.avgRespond),noTotal:!0})]})]})},ht=function(e){var t=e.data,a=e.handleClose,s=e.handleChangeName,c=e.show,o=e.stats,r=e.handlePin,i=Object(n.useState)(t.displayName),l=Object(h.a)(i,2),d=l[0],m=l[1],g=Object(n.useState)(t.displayName),b=Object(h.a)(g,2),p=b[0],f=b[1],O=Object(n.useState)(!1),v=Object(h.a)(O,2),x=v[0],w=v[1],C=Object(n.useState)(""),y=Object(h.a)(C,2),S=y[0],_=y[1];console.log(o),Object(n.useEffect)((function(){m(t.displayName),f(t.displayName)}),[t.displayName]),Object(n.useEffect)((function(){if(t.agentId){var e=JSON.parse(localStorage.agents)[t.agentId];_(e.fullName)}else _()}),[t]);var N=function(){var e=Object(j.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:13===t.keyCode&&(s(d),t.target.blur(),f(d),m(d));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(e){27===e.keyCode&&a()};Object(n.useEffect)((function(){a()}),[t.chatId]),Object(n.useEffect)((function(){return document.addEventListener("keydown",I,!1),function(){document.removeEventListener("keydown",I,!1)}}),[]);return Object(T.jsxs)("div",{className:k()(ot.a.container,ot.a[c]),children:[Object(T.jsx)("div",{className:ot.a.close,onClick:a,children:"\xd7"}),Object(T.jsx)("img",{className:ot.a.profilePic,src:t.profilePic,alt:""}),Object(T.jsxs)("div",{className:ot.a.dataContainer,children:[Object(T.jsx)("input",{className:ot.a.nameInput,type:"text",value:d,onKeyDown:N,onFocus:function(){w(!0)},onBlur:function(){m(p),w(!1)},onChange:function(e){return m(e.target.value)}}),x&&Object(T.jsx)("div",{className:ot.a.hintBubble,children:"Aperte enter para salvar ou clique fora do campo para cancelar"}),Object(T.jsx)("h3",{children:U(t.chatId)}),Object(T.jsxs)("div",{className:ot.a.salesAgent,children:[Object(T.jsxs)("h2",{children:["Atendente: ",S||"Nenhum"]}),Object(T.jsx)("button",{onClick:function(){t.agentId===window.me?r(!0):r(!1)},children:Object(T.jsx)("img",{src:rt,alt:"Trocar"})})]}),Object(T.jsx)(jt,{data:o})]})]})},mt=function(e){var t=e.chat,a=e.handleChangeName,s=e.handleSend,c=e.handleDelete,o=e.handleSendAudio,r=e.handleLoadMore,l=e.handleModal,d=e.handlePin,u=e.handleBack,j=e.initialText,m=e.showMedia,g=e.showing,b=Object(n.useState)(!1),p=Object(h.a)(b,2),f=p[0],O=p[1],v=Object(n.useState)({}),x=Object(h.a)(v,2),w=x[0],C=x[1],y=function(e){for(var t=0,a=0;a<e.length;a++)t+=parseInt(e[a],10);return t/e.length};return Object(n.useEffect)((function(){t&&t.messages.length&&function(e){var t,a=[],n=[],s=e[0].mine,c={sentMessages:0,receivedMessages:0,sentTexts:0,receivedTexts:0,sentAudios:0,receivedAudios:0,sentImages:0,receivedImages:0},o=Math.abs(F()(e[0].timestamp).diff(F()(e[e.length-1].timestamp),"days"));e.forEach((function(r,l){if(r.mine){if(s||t||(t=new Date(r.timestamp)-new Date(e[l-1].timestamp)),c.sentMessages++,"ptt"===r.type||"audio"===r.type?c.sentAudios++:"image"===r.type?c.sentImages++:c.sentTexts++,e[l-1]&&!e[l-1].mine){var d=new Date(r.timestamp)-new Date(e[l-1].timestamp);d<864e5&&a.push(d)}}else if(s&&!t&&(t=new Date(r.timestamp)-new Date(e[l-1].timestamp)),c.receivedMessages++,"ptt"===r.type||"audio"===r.type?c.receivedAudios++:"image"===r.type?c.receivedImages++:c.receivedTexts++,e[l-1]&&e[l-1].mine){var u=new Date(r.timestamp)-new Date(e[l-1].timestamp);u<864e5&&n.push(u)}var j=y(n),h=y(a);C(Object(i.a)({avgReceive:j,avgRespond:h,daysOfConversation:o,salesContacted:s,initialResponseTime:t},c))}))}(t.messages.slice().reverse())}),[t]),t?Object(T.jsxs)("div",{className:k()(fe.a.chatContainer,"mobile-fullwidth",g),id:"main",children:[Object(T.jsx)(ve,{data:t,handleBack:u,handleToggleDetails:function(){return O(!f)}}),Object(T.jsx)(nt,{handleModal:l,showMedia:m,handleLoadMore:r,send:s,handleDelete:c,sendAudio:o,more:t.more,chatId:t.chatId,handleChangeName:a,messages:t.messages,loading:t.firstClick,initialText:j}),Object(T.jsx)(ht,{show:f,data:t,stats:w,handlePin:d,handleChangeName:a,handleClose:function(){return O(!1)}})]}):Object(T.jsx)(st,{showing:g})},gt=a(87),bt=a(89),pt=(a(171),a(6)),ft=a.n(pt),Ot=a.p+"static/media/logo.2641acfa.png",vt=a.p+"static/media/loading.7b91d452.gif",xt=JSON.parse(localStorage.settings||1),wt=function(e){var t=e.file,a=e.onClose,s=e.handleSendImage,c=e.handleNewChat,o=e.handleLogin,l=e.handleUpload,d=e.selectUser,u=e.saveSales,j=e.handleChangeSettings,m=e.handleSearch,g=e.passiveSearch,b=Object(n.useState)(""),f=Object(h.a)(b,2),O=f[0],v=f[1],x=Object(n.useState)(""),C=Object(h.a)(x,2),y=C[0],S=C[1],_=Object(n.useState)(""),N=Object(h.a)(_,2),I=N[0],A=N[1],M=Object(n.useState)(!1),E=Object(h.a)(M,2),B=E[0],D=E[1],q=Object(n.useState)(t&&t.settings||xt),R=Object(h.a)(q,2),L=R[0],F=R[1];Object(n.useEffect)((function(){D(!1),v(""),S(""),A(""),t&&t.newNumber?S(t.newNumber):t&&"sale"===t.type?S("sale"):t&&"advancedSearch"===t.type&&v(window.me)}),[t]);var P,V,G,J=function(e){e.preventDefault(),D(!0),s(O)},U=function(e){if(e.preventDefault(),y.match(/^\(\d{2}\) \d{5}-\d{4}$/g)){D(!0);var t="55"+y.replace(/\D/g,"")+"@c.us";c(y,t)}else alert("N\xfamero inv\xe1lido")},W=function(e){e.preventDefault(),O&&I?o(O,I):alert("Insira seu usu\xe1rio e senha!")},Q=function(){var e=O,t=I,a=y,n=/^[0-9]{1,4}([.,][0-9]{1,2})?$/g;if(e.match(n)&&("sale"!==y||t.match(n))){var s={itemCount:e.replace(",","."),totalValue:t.replace(",","."),type:a};D(!0),u(s)}else alert("Dados inv\xe1lidos. Verifique os n\xfameros")},H=function(e){var t=e.target;console.log(t.name,t.checked);var a=Object(i.a)(Object(i.a)({},L),{},Object(r.a)({},t.name,t.checked));F(a),j(a)};return t&&"image"===t.type?Object(T.jsx)(gt.a,{imagePadding:32,mainSrc:"".concat(w,"chats/download/").concat(t.id,"?access_token=").concat(localStorage.access_token),onCloseRequest:a}):t&&"qr"===t.type?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{className:ft.a.modalBackground}),Object(T.jsxs)("div",{className:k()(ft.a.modal,ft.a.opaque),children:[Object(T.jsx)("p",{children:t.update}),t.qr?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("h2",{children:"Escaneie o QR code pelo WhatsApp"}),Object(T.jsx)("img",{className:ft.a.qr,src:t.qr,alt:"QR code"})]}):null,t.status?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("h1",{children:"QR code validado. Carregando..."}),Object(T.jsx)("h4",{children:"".concat(t.partial,"/").concat(t.total)})]}):null,"no auto start"===t.offline?Object(T.jsx)("button",{className:ft.a.offlineButton,onClick:function(){localStorage.setItem("useSavedData",1),window.location.reload()},children:"Sincronizar para an\xe1lises"}):null]})]}):t&&"video"===t.type?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{onClick:a,className:ft.a.modalBackground}),Object(T.jsx)("div",{onClick:a,className:k()(ft.a.close,ft.a.absolutePosition),children:"\xd7"}),Object(T.jsx)("div",{className:ft.a.modal,children:Object(T.jsx)("video",{src:"".concat(w,"chats/download/").concat(t.id,"?access_token=").concat(localStorage.access_token),alt:"V\xeddeo",autoPlay:!0,controls:!0})})]}):t&&"offline"===t.type?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{className:ft.a.modalBackground}),Object(T.jsxs)("div",{className:k()(ft.a.modal,ft.a.opaque),children:[Object(T.jsx)("h1",{children:"Parece que o celular principal n\xe3o est\xe1 online. Verifique e aguarde."}),Object(T.jsx)("h3",{children:t.reason})]})]}):t&&"picUpload"===t.type?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{onClick:a,className:ft.a.modalBackground}),Object(T.jsxs)("div",{className:k()(ft.a.modal,ft.a.opaque),children:[Object(T.jsx)("div",{onClick:a,className:ft.a.close,children:"\xd7"}),Object(T.jsx)("h1",{children:"Enviar imagem"}),Object(T.jsx)("label",{htmlFor:"upload-button",children:Object(T.jsx)("div",{className:ft.a.button,children:"Enviar foto ou v\xeddeo"})}),Object(T.jsx)("input",{type:"file",accept:"image/*,video/*",capture:!0,multiple:!0,id:"upload-button",style:{display:"none"},onChange:l}),Object(T.jsx)("label",{htmlFor:"upload-button2",children:Object(T.jsx)("div",{className:ft.a.button,children:"Enviar Outros arquivos"})}),Object(T.jsx)("input",{type:"file",accept:"*",id:"upload-button2",multiple:!0,style:{display:"none"},onChange:l})]})]}):t&&"photoUpload"===t.type?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{onClick:a,className:ft.a.modalBackground}),Object(T.jsxs)("div",{className:k()(ft.a.modal,ft.a.opaque),children:[Object(T.jsx)("div",{onClick:a,className:ft.a.close,children:"\xd7"}),"video"===t.format?Object(T.jsx)("video",{controls:!0,src:URL.createObjectURL(t.data)}):Object(T.jsx)("img",{src:URL.createObjectURL(t.data),alt:"Imagem"}),Object(T.jsxs)("form",{onSubmit:J,children:[Object(T.jsx)("input",{type:"text",placeholder:"Mensagem",value:O,onChange:function(e){return v(e.target.value)}}),Object(T.jsx)("input",{type:"submit",hidden:!0})]}),Object(T.jsx)("button",{disabled:B,onClick:J,children:B?Object(T.jsx)("img",{src:vt,alt:"loading spinner"}):"Enviar"})]})]}):t&&"newChat"===t.type?(window.agents&&(P=[],p.a.forEach(window.agents,(function(e,t){e.username&&e.isSalesAgent&&P.push([t,e.fullName])}))),Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{onClick:a,className:ft.a.modalBackground}),Object(T.jsxs)("div",{className:k()(ft.a.modal,ft.a.opaque),children:[Object(T.jsx)("div",{onClick:a,className:ft.a.close,children:"\xd7"}),t.newNumber&&localStorage.salesAgentId&&Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("h2",{children:"Vendedor(a):"}),Object(T.jsx)("form",{action:"null",children:Object(T.jsxs)("select",{value:localStorage.salesAgentId,onChange:function(e){return function(e){var t=window.agents[localStorage.salesAgentId];v(e),localStorage.setItem("salesAgentId",e),localStorage.setItem("salesAgentProfile",JSON.stringify(t))}(e.target.value)},children:[Object(T.jsx)("option",{value:"",disabled:!0,children:"Selecione..."}),P.map((function(e){return Object(T.jsx)("option",{value:e[0],children:e[1]},e[0])}))]})})]}),Object(T.jsx)("h2",{children:"N\xfamero:"}),Object(T.jsxs)("form",{onSubmit:U,children:[Object(T.jsx)(bt.a,{type:"tel",placeholder:"Celular",format:"(##) #####-####",value:y,onValueChange:function(e){return function(e){if(S(e),console.log(e),e.length>12&&e[13].match(/\d/)){var t="55"+e.replace(/\D/g,"");g(t)}}(e.formattedValue)}}),Object(T.jsx)("input",{type:"submit",hidden:!0})]}),Object(T.jsx)("button",{disabled:B,onClick:U,children:B?Object(T.jsx)("img",{src:vt,alt:"loading spinner"}):"Salvar"})]})]})):t&&"selectUser"===t.type?(window.agents&&(V=[],p.a.forEach(window.agents,(function(e,t){e.username&&e.isSalesAgent&&V.push([t,e.fullName])}))),Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{className:ft.a.modalBackground,onClick:onclose}),Object(T.jsxs)("div",{className:k()(ft.a.modal,ft.a.opaque),children:[Object(T.jsx)("div",{onClick:a,className:ft.a.close,children:"\xd7"}),Object(T.jsx)("h2",{children:"Vendedor(a)"}),Object(T.jsx)("form",{action:"null",children:Object(T.jsxs)("select",{value:O,onChange:function(e){return v(e.target.value)},children:[Object(T.jsx)("option",{value:"",disabled:!0,children:"Selecione..."}),V.map((function(e){return Object(T.jsx)("option",{value:e[0],children:e[1]},e[0])}))]})}),Object(T.jsx)("button",{disabled:B,onClick:function(){O?d(O):alert("Voc\xea deve selecionar um(a) vendedor(a)")},children:B?Object(T.jsx)("img",{src:vt,alt:"loading spinner"}):"Entrar"}),Object(T.jsx)("form",{action:""})]})]})):t&&"login"===t.type?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{className:ft.a.modalBackground}),Object(T.jsxs)("div",{className:k()(ft.a.modal,ft.a.opaque),children:[Object(T.jsx)("img",{className:ft.a.logo,src:Ot,alt:"Zoppy"}),Object(T.jsx)("h2",{children:"Acesse sua conta"}),Object(T.jsxs)("form",{onSubmit:W,noValidate:!0,children:[Object(T.jsx)("input",{type:"email",placeholder:"usu\xe1rio",value:O,onChange:function(e){return v(e.target.value)}}),Object(T.jsx)("input",{type:"password",placeholder:"senha",value:I,onChange:function(e){return A(e.target.value)}}),Object(T.jsx)("input",{type:"submit",hidden:!0})]}),Object(T.jsx)("button",{disabled:B,onClick:W,children:B?Object(T.jsx)("img",{src:vt,alt:"loading spinner"}):"Entrar"}),Object(T.jsx)("form",{action:""})]})]}):t&&"settings"===t.type?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{onClick:a,className:ft.a.modalBackground}),Object(T.jsxs)("div",{className:k()(ft.a.modal,ft.a.opaque),children:[Object(T.jsx)("div",{onClick:a,className:ft.a.close,children:"\xd7"}),Object(T.jsxs)("div",{className:ft.a.settings,children:[Object(T.jsx)("h2",{children:"Configura\xe7\xf5es"}),Object(T.jsxs)("label",{children:["Selecionar vendedor",Object(T.jsx)("input",{type:"checkbox",name:"manageUsersLocally",checked:L.manageUsersLocally,onChange:H})]}),Object(T.jsx)("br",{}),Object(T.jsx)("br",{}),Object(T.jsxs)("label",{children:["Mostrar op\xe7\xf5es de convers\xe3o",Object(T.jsx)("input",{type:"checkbox",name:"salesOptions",checked:L.salesOptions,onChange:H})]})]}),Object(T.jsx)("button",{disabled:B,onClick:a,children:B?Object(T.jsx)("img",{src:vt,alt:"loading spinner"}):"Salvar"})]})]}):t&&"sale"===t.type?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{className:ft.a.modalBackground}),Object(T.jsxs)("div",{className:k()(ft.a.modal,ft.a.opaque),children:[Object(T.jsx)("div",{onClick:a,className:ft.a.close,children:"\xd7"}),Object(T.jsx)("h2",{children:"Sacolinha"}),Object(T.jsxs)("form",{action:"",onSubmit:Q,noValidate:!0,children:[Object(T.jsx)("input",{type:"number",placeholder:"Num. itens",value:O,onChange:function(e){return v(e.target.value)}}),Object(T.jsxs)("div",{className:ft.a.saleType,children:[Object(T.jsx)("input",{checked:"sale"===y,onChange:function(){return S("sale")},type:"radio",name:"saleType",id:"sale"}),Object(T.jsx)("label",{htmlFor:"sale",children:"Venda"}),Object(T.jsx)("input",{checked:"bag"===y,onChange:function(){return S("bag")},type:"radio",name:"saleType",id:"bag"}),Object(T.jsx)("label",{htmlFor:"bag",children:"Malinha"})]}),"sale"===y?Object(T.jsx)("input",{type:"number",placeholder:"Valor total",value:I,onChange:function(e){return A(e.target.value)}}):null,Object(T.jsx)("input",{type:"submit",hidden:!0})]}),Object(T.jsx)("button",{disabled:B,onClick:Q,children:B?Object(T.jsx)("img",{src:vt,alt:"loading spinner"}):"salvar"}),Object(T.jsx)("form",{action:""})]})]}):t&&"advancedSearch"===t.type?(window.agents&&(G=[],p.a.forEach(window.agents,(function(e,t){"WhatsApp"!==e.fullName&&G.push([t,e.fullName])}))),Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{className:ft.a.modalBackground,onClick:onclose}),Object(T.jsxs)("div",{className:k()(ft.a.modal,ft.a.opaque),children:[Object(T.jsx)("div",{onClick:a,className:ft.a.close,children:"\xd7"}),Object(T.jsx)("h2",{children:"Atendente"}),Object(T.jsxs)("form",{children:[Object(T.jsxs)("select",{value:O,onChange:function(e){return v(e.target.value)},children:[Object(T.jsx)("option",{value:"",disabled:!0,children:"Selecione..."}),Object(T.jsx)("option",{value:"all",children:"Todos"}),G.map((function(e){return Object(T.jsx)("option",{value:e[0],children:e[1]},e[0])}))]}),Object(T.jsx)("br",{}),Object(T.jsx)("br",{}),Object(T.jsxs)("label",{children:["Apenas n\xe3o lidas",Object(T.jsx)("input",{type:"checkbox",checked:y,onChange:function(){return S(!y)}})]})]}),Object(T.jsx)("button",{onClick:function(){m(O,y)},children:"Filtrar"}),Object(T.jsx)("form",{action:""})]})]})):null},Ct=[ue,je,he,me,ge,be],yt=JSON.parse(localStorage.chats||0),St=JSON.parse(localStorage.settings||0)||{manageUsersLocally:!1,salesOptions:!1},_t=JSON.parse(localStorage.adminSettings||0);window.webVersion=S;var Nt=function(){var e=Object(v.a)(yt||[]),t=Object(h.a)(e,2),a=t[0],s=t[1],c=Object(n.useState)(),o=Object(h.a)(c,2),d=o[0],m=o[1],b=Object(n.useState)(),f=Object(h.a)(b,2),x=f[0],S=f[1],_=Object(n.useState)(null),I=Object(h.a)(_,2),k=I[0],A=I[1],M=Object(n.useState)(null),E=Object(h.a)(M,2),B=E[0],D=E[1],q=Object(n.useState)(!1),R=Object(h.a)(q,2),L=R[0],F=R[1],P=Object(n.useState)("conversations"),V=Object(h.a)(P,2),W=V[0],Q=V[1],H=Object(n.useState)(!1),z=Object(h.a)(H,2),K=z[0],Y=z[1],Z=Object(n.useState)(St),X=Object(h.a)(Z,2),$=X[0],ee=X[1],te=Object(n.useState)(""),ae=Object(h.a)(te,2),ne=ae[0],se=ae[1],ce=Object(n.useState)(""),oe=Object(h.a)(ce,2),re=oe[0],ie=oe[1],ue=Object(n.useState)(_t||{}),je=Object(h.a)(ue,2),he=je[0],me=je[1],ge=window.innerWidth<=600,be=new Audio(de),pe=localStorage.salesAgentId||localStorage.userId,fe=!!he.launch;window.me=pe;var Oe=function(){var e=Object(j.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g()("".concat(w,"chats/online"),y);case 3:if(!e.sent.data&&!localStorage.useSavedData){e.next=12;break}return xe(),e.next=8,ye(G);case 8:Ze(),window.socket=G,e.next=15;break;case 12:alert("Ops, sua conex\xe3o foi perdida. Continue para sincronizar novamente."),We(),window.location.reload(!0);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),401===e.t0.response.status&&(alert("Fizemos alguns ajustes por aqui, e voc\xea vai ter que logar novamente"),We(),window.location.reload(!0));case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(){return e.apply(this,arguments)}}(),ve=function(e){var t=["TIMEOUT","CONNECTED","PAIRING","OPENING"];t.includes(e.connection)||localStorage.useSavedData?t.includes(e.connection)&&k&&"offline"===k.type?A(!1):!e.charging&&e.battery<20?Y(!0):(e.charging||e.battery>20)&&Y(!1):(window.workingOffline=!0,console.log("OFFLINE",e),A({type:"offline",reason:e.connection}),g.a.post("".concat(w,"/chats/refocus"),{},y))},xe=function(){var e=Object(j.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g()("".concat(w,"chats/status"),y);case 2:t=e.sent,a=t.data,ve(a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),we=function(e){switch(e){case"conversations":Q("conversations"),window.location.hash="";break;case"chat":Q("chat"),window.location.hash="chat"}};Object(n.useEffect)((function(){window.agents=JSON.parse(localStorage.agents||0),localStorage.access_token?(Oe(),(G=O.a.apply(void 0,Object(l.a)(C))).on("reload",(function(){localStorage.removeItem("chats"),window.location.reload(!0)})),G.on("status",(function(e){console.log(e),ve(e)})),G.on("loadedAMessage",(function(e){e.total?A(Object(i.a)({type:"qr",status:"loading"},e)):A(Object(i.a)(Object(i.a)({},k),e))}))):(We(),A({type:"login"})),localStorage.settings?"/"===window.location.pathname&&JSON.parse(localStorage.settings).manageUsersLocally&&A({type:"selectUser"}):localStorage.setItem("settings",JSON.stringify({manageUsersLocally:!1,salesOptions:!1})),window.addEventListener("load",(function(){window.history.pushState({noBackExitsApp:!0},"")})),window.addEventListener("hashchange",Ce)}),[]),Object(n.useEffect)((function(){if(console.log("UPDATED"),G)return G.on("loadedChats",(function(e){console.log(e),Te(e.data)})),function(){G.off("loadedChats")}}),[he]),Object(n.useEffect)((function(){return G&&(G.on("newMessage",(function(e){console.log("recieved",e),Ee(e)})),G.on("sentMessage",(function(e){De(e)})),G.on("deleteMsgs",(function(e){$e(e)})),G.on("queryResult",(function(e){et(e)})),G.on("setAgent",(function(e){ze(e)}))),B&&a[0].chatId===B.chatId&&Be(a[0].chatId),function(){G&&(G.off("newMessage"),G.off("setAgent"),G.off("sentMessage"),G.off("queryResult"))}}),[a,B]),Object(n.useEffect)((function(){var e=Se(d);x!==e&&S(e),a.length&&!L&&(F(!0),Ie()),function(){var e=a.map((function(e){var t=e.displayName,a=e.agentLetter,n=e.chatId,s=e.lastMessageAt,c=e.type,o=e.messages,r=e.profilePic;return{displayName:t,agentLetter:a,chatId:n,lastMessageAt:s,type:c,messages:[o[0]],filtered:!0,firstClick:!1,profilePic:r}}));localStorage.setItem("chats",JSON.stringify(e))}()}),[a]),function(e,t){var a=Object(n.useRef)();Object(n.useEffect)((function(){a.current=e}),[e]),Object(n.useEffect)((function(){if(null!==t){var e=setInterval((function(){a.current()}),t);return function(){return clearInterval(e)}}}),[t])}((function(){k&&"offline"===k.type&&xe()}),5e3);var Ce=function(){var e=window.location.hash;e?"#chat"===e&&Q("chat"):Q("conversations")},ye=function(){var e=Object(j.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage.removeItem("chats"),Ke(),Ye(),console.log("requesting chats"),t.emit("getChats");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Se=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;return t.findIndex((function(t){return t.chatId===e}))},_e=function(e,t){var a=Se(t);s((function(t){for(var n in e)if(e.hasOwnProperty(n)&&a>=0){var s=e[n];t[a][n]=s}}))},Ne=function(){var e=Object(j.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g()("".concat(w,"chats/findChat/").concat(t),y);case 2:(a=e.sent).data.length&&et([a.data]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=Object(j.a)(u.a.mark((function e(){var t,a,n,s,c,o,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=window.location.search.substring(1))){e.next=8;break}o=JSON.parse('{"'+t.replace(/&/g,'","').replace(/=/g,'":"')+'"}',(function(e,t){return""===e?t:decodeURIComponent(t)})),a=/^55(\d{2})([89]?)(\d{4})(\d{4})$/g.exec(o.phone),ie(o.text),console.log(o.text),e.next=12;break;case 8:if(!((r=window.location.pathname.split("/")[1]).length<12)){e.next=11;break}return e.abrupt("return");case 11:a=/^55(\d{2})([89]?)(\d{4})(\d{4})$/g.exec(r);case 12:if(a){e.next=14;break}return e.abrupt("return");case 14:s=55+a[1]+a[2]+a[3]+a[4]+"@c.us",c="(".concat(a[1],") ").concat(a[2]||9).concat(a[3],"-").concat(a[4]),n=s.substring(0,4)+s.substring(5,s.length),se(c),Se(n)>=0?ke(n):Se(s)>=0?ke(s):(A({type:"newChat",newNumber:c}),Ne(a[3]+a[4])),window.history.pushState({},"Zoppy","/"),window.location.hash="";case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=Object(j.a)(u.a.mark((function e(t){var n,s,c,o,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Se(t),s=a[n],D(!1),Re(null,t),we("chat"),m(s.chatId),S(n),console.log("54546654",a[n].messages),c={},e.prev=9,e.next=12,g()("".concat(w,"chats/").concat(s.chatId,"/profilePic"),y);case 12:c=e.sent,e.next=18;break;case 15:e.prev=15,e.t0=e.catch(9),console.log("fail to load pic");case 18:if(o={unread:0,profilePic:c.data||s.profilePic},$.isAdmin&&delete o.unread,!s.firstClick){e.next=27;break}return e.next=23,Me(s.chatId);case 23:r=e.sent,_e(Object(i.a)({messages:r,firstClick:!1},o),s.chatId),e.next=28;break;case 27:_e(o,s.chatId);case 28:$.isAdmin||g.a.patch("".concat(w,"chats/").concat(s.chatId,"/seen"),{},y);case 29:case"end":return e.stop()}}),e,null,[[9,15]])})));return function(t){return e.apply(this,arguments)}}(),Ae=function(){var e=Object(j.a)(u.a.mark((function e(t){var a,n,c=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.length>1&&void 0!==c[1]?c[1]:d,e.prev=1,e.next=4,g.a.patch("".concat(w,"chats/").concat(a,"/name"),{name:t},y);case 4:n=Se(a),s((function(e){e[n].displayName=t})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),Me=function(){var e=Object(j.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g()("".concat(w,"chats/").concat(t,"/messages"),y);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ee=function(e){var t,n=e.message,c=Se(n.chatId,a);if(console.log(c,e),he.viewOthersChats||!e.agentId||e.agentId===pe){if(c<0)return e.profilePic=Ct[Math.floor(6*Math.random())],e.displayName=U(n.chatId),e.firstClick=!0,e.more=!0,e.unread=1,e.filtered=!0,e.messages=[n],e.chatId=n.chatId,n.mine||be.play(),void s((function(t){t.unshift(e)}));if(e.chatId!==d&&"sale"!==n.type)(!a[c].agentId||a[c].agentId===pe)&&n.timestamp>=a[c].lastMessageAt&&!n.mine&&(t=!0);var o=a[c].unread;c===x||n.mine||(o?o+=1:o=1),s((function(t){t[c].messages.unshift(e.message),t[c].lastMessageAt=e.message.timestamp||(new Date).toISOString(),t[c].unread=o,t.sort((function(e,t){return e.lastMessageAt<t.lastMessageAt?1:-1}))})),t&&be.play(),x>=0&&c>x&&S(x+1)}},Be=function(e){console.log(Se(e)),console.log(a[0]),He(!1,e),S(0),ke(e)},De=function(e){var t={chatId:e.chatId,message:e};console.log(e);var n=Se(t.chatId);if(B&&e.agentId===pe)console.log("adding");else if(n<0&&!he.viewOthersChats)return;if(n<0)return t.profilePic=Ct[Math.floor(6*Math.random())],t.displayName=U(t.chatId),t.filtered=!0,t.messages=[e],void s((function(e){e.unshift(t)}));var c=a[n].messages.findIndex((function(t){return t.sending&&t.body===e.body}));s((function(t){p.a.remove(t[n].messages,(function(t){return t.messageId===e.messageId})),c>=0?t[n].messages[c]=e:t[n].messages.unshift(e),t[n].lastMessageAt=e.timestamp||(new Date).toISOString(),t[n].unread=0,t[n].messages.sort((function(e,t){return e.timestamp<t.timestamp?1:-1})),t.sort((function(e,t){return e.lastMessageAt<t.lastMessageAt?1:-1}))})),c>=0&&S(0)},qe=function(e){var t=Se(e[0].chatId);s((function(a){a[t]&&"none"===a[t].messages[0]&&a[t].messages.splice(0,1),e.forEach((function(e){a[t].messages.findIndex((function(t){return t.messageId===e.messageId}))<0&&a[t].messages.push(e)}))}))},Te=function(e,t){console.log(he);var a=!he.viewOthersChats;s((function(n){J||(J=1,n.splice(0,n.length)),e.forEach((function(e){var s=Object(i.a)({},e),c=Ct[Math.floor(6*Math.random())],o=n.findIndex((function(e){return e.chatId===s.chatId}));s.profilePic=s.profilePic||c,s.filtered=!0,s.displayName=s.name,s.more=!0,s.firstClick=!0,s.displayName=s.customName||s.name,a&&s.agentId&&window.me!==s.agentId||(s.messages&&s.messages.length?s.messages.length&&s.messages[0].mine&&(s.unread=0):s.messages=["none"],o<0?n.push(s):t||(n[o]=s))})),n.sort((function(e,t){return e.lastMessageAt<t.lastMessageAt?1:-1}));var s=n.findIndex((function(e){return e.chatId===d}));S(s)}))},Re=function(){var e=Object(j.a)(u.a.mark((function e(t){var n,s,c,o,r,i=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:d,s=Se(n),c=Object(l.a)(a),o=c[s].messages.length,"none"===c[s].messages[0]&&(o=0),e.next=7,g()("".concat(w,"chats/").concat(n,'/messages?filter={"skip":').concat(o,"}"),y);case 7:(r=e.sent).data.length?qe(r.data):(console.log("no msgs"),_e({more:!1},n));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Le=function(){var e=Object(j.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.substring(0,4)+t.substring(5,t.length),G.emit("queryChat",{string:a});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Fe=function(){var e=Object(j.a)(u.a.mark((function e(t,a){var n,s,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.substring(0,4)+a.substring(5,a.length),!(Se(n)>=0)){e.next=6;break}return ke(n),A(!1),e.abrupt("return");case 6:if(!(Se(a)>=0)){e.next=11;break}return ke(a),A(!1),e.abrupt("return");case 11:return e.next=13,g.a.get("".concat(w,"chats/").concat(a,"/check"),y);case 13:if((s=e.sent).data){e.next=19;break}return alert("Esse n\xfamero n\xe3o tem WhatsApp! Tente novamente"),A(!1),A({type:"newChat"}),e.abrupt("return");case 19:c={profilePic:Ct[Math.floor(6*Math.random())],chatId:s.data,displayName:t,messages:["none"],type:"chat",timestamp:0},we("chat"),D(c),A(!1);case 23:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),Pe=function(){var e=Object(j.a)(u.a.mark((function e(t,n){var c,o,r,l,j,h,m=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=m.length>2&&void 0!==m[2]?m[2]:d,m.length>3&&void 0!==m[3]?m[3]:0,console.log(t,n),r=t.trim()){e.next=6;break}return e.abrupt("return");case 6:return B&&(c=B.chatId),$.manageUsersLocally&&localStorage.salesAgentId&&(o=localStorage.salesAgentId),console.log("sending"),l=(new Date).valueOf(),j={messageId:l,mine:!0,agentId:pe,body:r,timestamp:(new Date).toISOString(),sending:!0,type:"chat",sender:"Voc\xea",chatId:c},c===d?(a[h=x].agentId===pe||$.preventChatChange||He(),s((function(e){e[h].messages.unshift(j)}))):D(Object(i.a)(Object(i.a)({},B),{},{messages:[j]})),e.prev=12,e.next=15,g.a.post("".concat(w,"chats/").concat(c,"/send"),{message:r,from:o,customId:l,quoted:n},y);case 15:e.next=21;break;case 17:throw e.prev=17,e.t0=e.catch(12),console.log(e.t0),e.t0;case 21:case"end":return e.stop()}}),e,null,[[12,17]])})));return function(t,a){return e.apply(this,arguments)}}(),Ve=function(){var e=Object(j.a)(u.a.mark((function e(t){var a,n,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,(n=new FormData).append("",a),e.next=5,g.a.post("".concat(w,"chats/").concat(d,"/sendAudio"),n,Object(i.a)(Object(i.a)({},y),{},{headers:{accept:"application/json","Content-Type":"application/form-data"}}));case 5:s=e.sent,console.log(s);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ge=function(){var e=Object(j.a)(u.a.mark((function e(t){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=k.data,(n=new FormData).append("",a),n.append("caption",t),e.next=6,g.a.post("".concat(w,"chats/").concat(d,"/sendMedia"),n,Object(i.a)(Object(i.a)({},y),{},{headers:{accept:"application/json","Content-Type":"application/form-data"}}));case 6:return A(!1),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Je=function(){var e=Object(j.a)(u.a.mark((function e(t,a){var n,s,c,o,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="username",t.includes("@")&&(n="email"),e.prev=2,e.next=5,g.a.post("".concat(w,"agents/login"),(s={},Object(r.a)(s,n,t),Object(r.a)(s,"password",a),s));case 5:return c=e.sent,localStorage.setItem("access_token",c.data.id),localStorage.setItem("userId",c.data.userId),e.next=10,g()("".concat(w,"chats/online"),{params:{access_token:c.data.id}});case 10:if(o=e.sent.data,console.log(o),!o&&!localStorage.useSavedData){e.next=17;break}localStorage.setItem("connected",!0),window.location.reload(!0),e.next=30;break;case 17:if(window.confirm("O celular est\xe1 desconectado da Zoppy. Confira sua conex\xe3o. Caso esteja com o celular em m\xe3os e queira configurar novamente, pressione ok")){e.next=21;break}return window.alert("Avise o respons\xe1vel sobre o erro de conex\xe3o!"),e.abrupt("return");case 21:return(G=O.a.apply(void 0,Object(l.a)(C))).on("scanned",(function(){console.log("SCANNED"),A({type:"qr",status:"scanned"})})),G.on("reload",(function(){window.location.reload(!0)})),G.on("QR",(function(e){console.log(e),A({type:"qr",qr:e})})),e.next=27,g.a.post("".concat(w,"chats/init"),{},{params:{access_token:c.data.id}});case 27:i=e.sent,localStorage.removeItem("chats"),A({type:"qr",offline:i.data});case 30:e.next=36;break;case 32:e.prev=32,e.t0=e.catch(2),console.log(e.t0),alert("Email ou senha incorreto");case 36:case"end":return e.stop()}}),e,null,[[2,32]])})));return function(t,a){return e.apply(this,arguments)}}(),Ue=function(){var e=Object(j.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(G=O.a.apply(void 0,Object(l.a)(C))).on("scanned",(function(){console.log("SCANNED"),A({type:"qr",status:"scanned"})})),G.on("reload",(function(){window.location.reload(!0)})),G.on("QR",(function(e){console.log(e),A({type:"qr",qr:e})})),e.next=6,g.a.post("".concat(w,"chats/init"),{force:!0,reset:!0,owner:localStorage.userId},y);case 6:localStorage.removeItem("chats"),A({type:"qr"});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),We=function(){localStorage.removeItem("userId"),localStorage.removeItem("access_token"),localStorage.removeItem("connected")},Qe=function(){var e=Object(j.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!$.manageUsersLocally||t){e.next=4;break}A({type:"selectUser"}),e.next=8;break;case 4:return e.next=6,g.a.post("".concat(w,"agents/logout"),{},y);case 6:We(),A({type:"login"});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),He=function(){var e=Object(j.a)(u.a.mark((function e(t){var a,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.length>1&&void 0!==n[1]?n[1]:d,e.prev=1,e.next=4,g.a.patch("".concat(w,"chats/").concat(a,"/claim"),{remove:!!t,customId:localStorage.salesAgentId},y);case 4:e.next=11;break;case 6:throw e.prev=6,e.t0=e.catch(1),console.log(e.t0.response),alert(e.t0.response.message),new Error("error");case 11:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}(),ze=function(e){console.log(e);var t=!he.viewOthersChats,a=e.agentId,n=e.agentLetter,c=Se(e.chatId);c>=0?s((function(e){console.log(c),e[c].agentId=a,e[c].agentLetter=n,t&&a&&a!==pe&&e.splice(c,1)})):t&&!a&&(console.log("searching"),tt(e.chatId.slice(0,11)),tt(""))},Ke=function(){var e=Object(j.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g()("".concat(w,"agents/list"),y);case 3:t=e.sent,(a=t.data).wpp={fullName:"WhatsApp"},window.agents=a,localStorage.setItem("agents",JSON.stringify(a)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),Ye=function(){var e=Object(j.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g()("".concat(w,"admins"),y);case 3:t=e.sent,a=t.data,localStorage.setItem("adminSettings",JSON.stringify(a)),a.importSettings&&localStorage.setItem("useSavedData",1),console.log(a),me(a),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),Ze=function(){var e=Object(j.a)(u.a.mark((function e(){var t,a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g()("".concat(w,"agents/").concat(localStorage.userId),y);case 3:t=e.sent,(a=t.data).settings&&ee(a.settings),a.settings&&a.settings.isAdmin&&he&&(console.log(a.settings),n=Object(i.a)(Object(i.a)({},he),{},{viewOthersChats:!0}),localStorage.setItem("settings",JSON.stringify(n)),me(n),G.emit("getChats")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),Xe=function(){var e=Object(j.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.a.delete("".concat(w,"chats/").concat(d,"/deleteMessages"),{data:[t],params:{access_token:y.params.access_token}});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),$e=function(e){var t=e.chatId,a=e.deleted,n=Se(t);s((function(e){p.a.remove(e[n].messages,(function(e){return a.includes(e.messageId)}))}))},et=function(e){var t=e.res,a=e.pinned,n=e.string;if(t){var s=t.map((function(e){var t=n.toLowerCase(),s=!0,c=!0;return n&&(s=e.displayName&&e.displayName.toLowerCase().includes(t)||e.chatId.slice(2,12).includes(t)),a&&(c=e.agentId===pe),e.filtered=s&&c,e}));s.length&&Te(s,!0)}},tt=function(e,t){G.emit("queryChat",{pinned:t,string:e}),s((function(a){a.map((function(a){var n=e.toLowerCase(),s=!0,c=!0;return e&&(s=a.displayName&&a.displayName.toLowerCase().includes(n)||a.chatId.slice(2,12).includes(n)),t&&(c=a.agentId===pe),a.filtered=s&&c,a}))}))},at=function(){var e=Object(j.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.agentId=pe,t.chatId=d,e.next=4,g.a.post("".concat(w,"sales/new"),t,y);case 4:a=e.sent,console.log(a),Ee({chatId:a.data.chatId,message:a.data}),A(!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),nt=function(e){A({type:e})};return Object(T.jsxs)("main",{className:N.a.main,children:[Object(T.jsx)(wt,{file:k,onClose:function(){return A(!1)},handleSendImage:Ge,handleNewChat:Fe,handleChangeSettings:function(e){ee(e),localStorage.setItem("settings",JSON.stringify(e)),e.manageUsersLocally||(localStorage.removeItem("salesAgentProfile"),localStorage.removeItem("salesAgentId"))},handleLogin:Je,handleUpload:function(e){e.persist(),console.log(e.target.files[0]),A({data:e.target.files[0],type:"photoUpload",format:e.target.files[0].type.includes("video")?"video":"photo"}),e.target.value=null},handleSearch:function(e,t){A(!1),s((function(a){a.map((function(a){var n=!1;return"all"!==e||t?"all"===e&&t&&a.unread?n=!0:a.agentId!==e||t?a.agentId===e&&t&&a.unread&&(n=!0):n=!0:n=!0,a.filtered=n,a}))}))},saveSales:at,selectUser:function(e){localStorage.setItem("salesAgentId",e);var t=window.agents[e];localStorage.setItem("salesAgentProfile",JSON.stringify(t)),A(!1)},passiveSearch:Le}),Object(T.jsxs)("div",{className:N.a.container,children:[Object(T.jsx)(le,{showing:String(ge&&"conversations"===W),data:a,handleSettingsModal:function(){A({type:"settings",settings:$})},handleManualSync:Ue,logout:Qe,isLaunch:fe,handleQuery:tt,handleSelectChat:ke,lowBattery:K,handleNewContactModal:function(){A({type:"newChat",newNumber:ne}),se("")},handleModal:nt}),Object(T.jsx)(mt,{initialText:re,handleBack:function(){return we("conversations")},showing:String(ge&&"chat"===W),handleModal:nt,handleSendAudio:Ve,showMedia:function(e,t){A({type:e,id:t})},handleSend:Pe,handleDelete:Xe,handleChangeName:Ae,handleLoadMore:Re,chat:B||a[x],handlePin:He})]})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(T.jsx)(s.a.StrictMode,{children:Object(T.jsx)(Nt,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),window.VERSION=x.version},18:function(e,t,a){e.exports={container:"Conversations_container__qWCSX",chatsList:"Conversations_chatsList__5ZFOR",searchContainer:"Conversations_searchContainer__2t-Jn",pin:"Conversations_pin__IN16Z",true:"Conversations_true__3zKza",chat:"Conversations_chat__tpWya",info:"Conversations_info__3x34d",message:"Conversations_message__2nOMD",unread:"Conversations_unread__2jppe",letter:"Conversations_letter__2BMf-",lowBattery:"Conversations_lowBattery__3I5Zn",header:"Conversations_header__2TEBo",bg:"Conversations_bg__Fy8_9"}},20:function(e,t,a){e.exports={chat:"ChatBox_chat__34TQL",scroll:"ChatBox_scroll__2scZ8",container:"ChatBox_container__3sVfA",messages:"ChatBox_messages__28jBe",input:"ChatBox_input__38Djo",loadMore:"ChatBox_loadMore__B8DE2",linearActivity:"ChatBox_linearActivity__23EWW",indeterminate:"ChatBox_indeterminate__2Mcdq",indeterminate_first:"ChatBox_indeterminate_first__1rI0J",indeterminate_second:"ChatBox_indeterminate_second__3zO2b",emojiContainer:"ChatBox_emojiContainer__1493Q",emojiRoot:"ChatBox_emojiRoot__2-XqT",true:"ChatBox_true__1drss",hide:"ChatBox_hide__3VJj2",record:"ChatBox_record__3P1G0",recording:"ChatBox_recording__1pwio",voiceMessageRecorder:"ChatBox_voiceMessageRecorder__1Ek8m"}},23:function(e,t,a){e.exports={chatContainer:"Chat_chatContainer__29fRv",centerContainer:"Chat_centerContainer__1LA92",noChat:"Chat_noChat___DfYh",header:"Chat_header__2dzwL",profilePic:"Chat_profilePic__2p-2l",name:"Chat_name__17zfT",nameContainer:"Chat_nameContainer__DWsR-",pinContainer:"Chat_pinContainer__2II5G",active:"Chat_active__2ZvGz",arrow:"Chat_arrow__qAVEu",headerContent:"Chat_headerContent__1bIab",nameInput:"Chat_nameInput__Njdoa"}},24:function(e,t,a){e.exports={container:"ContactDetails_container__1YRuT",true:"ContactDetails_true__2fw43",close:"ContactDetails_close__xIkNr",profilePic:"ContactDetails_profilePic__2pL1H",dataContainer:"ContactDetails_dataContainer__2DRX-",nameInput:"ContactDetails_nameInput__ATxfT",hintBubble:"ContactDetails_hintBubble__2V9sb",salesAgent:"ContactDetails_salesAgent__1gra5",statsContainer:"ContactDetails_statsContainer__3ZSg3",counter:"ContactDetails_counter__2s8Ny"}},43:function(e){e.exports=JSON.parse('{"name":"view","version":"v82.0.0","private":true,"dependencies":{"@testing-library/jest-dom":"^5.11.9","@testing-library/react":"^11.2.5","@testing-library/user-event":"^12.7.2","axios":"^0.21.1","classnames":"^2.2.6","emoji-mart":"^3.0.0","immer":"^8.0.1","lodash":"^4.17.21","mic-recorder-to-mp3":"^2.2.2","moment":"^2.29.1","react":"^17.0.1","react-dom":"^17.0.1","react-emoji-render":"^1.2.4","react-image-lightbox":"^5.1.1","react-number-format":"^4.4.4","react-scripts":"4.0.2","react-virtualized-auto-sizer":"^1.0.2","react-window":"^1.8.6","socket.io-client":"^3.1.1","use-immer":"^0.4.2"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},5:function(e,t,a){e.exports={container:"Bubble_container__3zp6Q",options:"Bubble_options__3iQ6W",true:"Bubble_true__3pCbP",false:"Bubble_false__1Qgcd",right:"Bubble_right__3dgP0",left:"Bubble_left__2T7Ej",center:"Bubble_center__3iFQQ",time:"Bubble_time__3nKUc",sale:"Bubble_sale__FweD3",message:"Bubble_message__hkENb",buffer:"Bubble_buffer__2LMrl",day:"Bubble_day__1fmhW",image:"Bubble_image__2IoNd",sticker:"Bubble_sticker__UpjsJ",noBg:"Bubble_noBg__396Lo",audio:"Bubble_audio__Mur7g",audioController:"Bubble_audioController__1JJCY",paused:"Bubble_paused__1bGIe",msg:"Bubble_msg__2OJd2",quote:"Bubble_quote__38oy1",from:"Bubble_from__3Z1KW"}},51:function(e,t,a){e.exports={main:"App_main__3ZkGI",container:"App_container__1MQN3"}},54:function(e,t,a){e.exports={container:"Spinner_container__ZXxv9",loader:"Spinner_loader__2t1M8"}},6:function(e,t,a){e.exports={modalBackground:"modal_modalBackground__2bcES",modal:"modal_modal__2sHWD",close:"modal_close__2_ut9",absolutePosition:"modal_absolutePosition__3Gwgi",opaque:"modal_opaque__Y1FSs",button:"modal_button__YYNXp",logo:"modal_logo__EhvJ6",qr:"modal_qr__1dgA0",saleType:"modal_saleType__K5u6e"}},97:function(e,t,a){}},[[172,1,2]]]);
//# sourceMappingURL=main.c50cc6de.chunk.js.map